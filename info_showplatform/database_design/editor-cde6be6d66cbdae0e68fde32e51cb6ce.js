var editor=function(){function e(){if($("#zenpenbubble").length){lastRange=0,n();var e=document.createRange(),o=window.getSelection();o.removeAllRanges(),o.addRange(e),t()}}function t(){document.onkeyup=o,document.onmousedown=o,document.onmouseup=function(e){setTimeout(function(){o(e)},1)},window.addEventListener("resize",function(){i()});var e=!0;document.body.addEventListener("scroll",function(){return e?(e=!0,i(),setTimeout(function(){e=!0},250)):void 0})}function n(){v=document.querySelector(".content"),x=document.querySelector(".text-options"),y=x.querySelector(".options"),b=x.querySelector(".bold"),b.onclick=r,C=x.querySelector(".italic"),C.onclick=d,k=x.querySelector(".url"),k.onmousedown=m,R=x.querySelector(".url-input"),R.onblur=p,R.onkeydown=f}function o(e){var t=window.getSelection();return"url-input"===e.target.className||e.target.classList.contains("url")?(S=u(t.focusNode),c(),void 0):null!=e.target.parentNode.classList&&e.target.parentNode.classList.contains("ui-inputs")?(S=u(t.focusNode),c(),void 0):(t.isCollapsed===!0&&w===!1&&a(),t.isCollapsed===!1&&(S=u(t.focusNode),1==s(t.focusNode)&&(c(),i(),x.className="text-options active")),w=t.isCollapsed,void 0)}function i(){var e=window.getSelection(),t=e.getRangeAt(0),n=t.getBoundingClientRect();x.style.top=n.top-5+window.pageYOffset+"px",x.style.left=(n.left+n.right)/2+"px"}function c(){b.className=l(S,"B")?"bold active":"bold",C.className=l(S,"I")?"italic active":"italic",k.className=l(S,"A")?"url useicons active":"url useicons"}function a(){x.className="text-options fade",setTimeout(function(){"text-options fade"==x.className&&(x.className="text-options",x.style.top="-999px",x.style.left="-999px")},260)}function u(e){for(var t={};e.parentNode;)t[e.nodeName]=!0,e=e.parentNode,"A"===e.nodeName&&(t.url=e.getAttribute("href"));return t}function s(e){for(;e.parentNode;){if(void 0!==e.className&&e.className.indexOf("phrasable_on")>=0)return!0;e=e.parentNode}return!1}function l(e,t){return!!e[t]}function r(){document.execCommand("bold",!1)}function d(){document.execCommand("italic",!1)}function m(){"options"==y.className?(y.className="options url-mode",setTimeout(function(){var e=u(window.getSelection().focusNode);l(e,"A")?R.value=e.url:document.execCommand("createLink",!1,"/"),lastSelection=window.getSelection().getRangeAt(0),w=!1,R.focus()},100)):y.className="options"}function f(e){13===e.keyCode&&(e.preventDefault(),N(R.value),R.blur())}function p(){y.className="options",N(R.value),R.value="",S=u(window.getSelection().focusNode),c()}function N(e){g(),document.execCommand("unlink",!1),""!==e&&document.execCommand("createLink",!1,e)}function g(){window.getSelection().addRange(lastSelection)}var v,w,S,x,y,b,C,k,R;return{init:e}}();